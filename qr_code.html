<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สร้าง QR Code PromptPay</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <h2>สร้าง QR Code PromptPay สำหรับรับเงิน</h2>

    <label for="amount">จำนวนเงิน (บาท):</label>
    <input type="number" id="amount" placeholder="เช่น 100.00"><br><br>

    <button onclick="generateQRCode()">สร้าง QR Code</button>
    
    <br>
    <img id="qrcodeImage" alt="QR Code จะปรากฏที่นี่">
    
    <script>
        const promptpayId = '0834340341'; // เปลี่ยนเป็นหมายเลขโทรศัพท์ของคุณ

        function generateQRCode() {
            var amount = parseFloat(document.getElementById("amount").value);
            if (!amount || amount <= 0) {
                alert("กรุณากรอกจำนวนเงินให้ถูกต้อง");
                return;
            }

            // รูปแบบ PromptPay สำหรับหมายเลขโทรศัพท์
            var promptpayPayload = createPromptPayQR(promptpayId, amount);
            
            var qrCode = new QRCode(document.getElementById("qrcode"), {
                text: promptpayPayload,
                width: 256,
                height: 256
            });

            // แปลง QR Code เป็น Base64
            var canvas = document.querySelector("canvas");
            var base64Image = canvas.toDataURL("image/png");

            // แสดง QR Code ที่เป็น Base64
            document.getElementById("qrcodeImage").src = base64Image;
        }

        // ฟังก์ชันสำหรับสร้างข้อมูล QR ของ PromptPay
        function createPromptPayQR(phone, amount) {
            phone = phone.replace(/[^0-9]/g, '');  // ลบตัวอักษรที่ไม่ใช่หมายเลข
            if (phone.length === 10) phone = '0066' + phone.substring(1);  // แปลงเลขไทยเป็นฟอร์แมตสากล

            // สร้างฟอร์แมต QR Code ตาม PromptPay
            var qrData = `00020101021129370016A00000067701011101130066${phone}5802TH5303764${amount.toFixed(2).replace('.', '')}6304`;
            return qrData;
        }
    </script>
</body>
</html>
